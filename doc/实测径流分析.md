# 实测径流分析

一次洪水流量过程除包括本次洪水所形成的地面径流、表层流径流和地下径流外，往往还包括前期洪水尚未退完的部分水量及非本次降雨补给的深层地下径流，因此如果要对模型计算结果进行验证，需要对观测径流量进行分析计算。其次，还需要对洪水流量过程中的不同水源成分进行划分，才能在计算单位线时，有实测地表径流数据。

## 退水曲线分析

一个常见的流域出口断面的实测流量过程是前后洪水首尾相接的。因为流域出口断面流量是由不同水源的径流成分组成的，它们汇流过程不同，尤其是地下水，退水延滞性强，因此复式洪水过程很常见。
为了分割场次洪水过程以计算场次洪水总径流深或分割地下水，需要确定流域退水曲线，所以要分析流域的退水特性和规律。分析方法有多种，为了编程计算的便利，采用退水指数方程的方式，其余方式可参考书本——《水文预报》，在此不赘述。

退水指数方程：
$$Q_t=Q_0e^{-\frac{t}{K}}$$
式中，$Q_t$，$Q_0$分别为t时刻流量和起始退水流量，K是常数。
$$W_t=KQ_t$$
$W_t$为t时刻的蓄量。此式表明，当泄流量恒定时，K是泄完蓄水量所需时间，相当于流域平均汇流时间。

给出退水指数方程的差分形式，可以得到：
$$Q_{t+1}=Q_te^{-\frac{1}{K}}$$
令$C_g=e^{-\frac{1}{K}}$，则$K=-\frac{1}{lnC_g}$，$C_g$为常系数，反映退水速率，称为流量消退系数。

消退系数可由由计算时段始末的两个实测退水流量确定：$C_g=\frac{Q_{t+1}}{Q_t}$，由于实测流量的观测误差等，选择多组观测值进行计算较好，根据最小二乘法，书上给出如下公式：
$$\hat{C_g}=\frac{\sum_{i=1}^nQ_{i,1}Q_{i,2}}{\sum_{i=1}^nQ_{i,1}^2}$$
选择的样本代表性越佳越好。
实际编程计算中，采用矩阵运算很容易，也很容易推出上述公式，详见代码。

## 流量过程分割

在制作了流域退水曲线之后，可用于分割场次洪水过程线，计算次洪总径流深，分割地表径流和地下径流。
这部分以往常常手工计算，因此书本上没有给出十分适于编程的方式，结合《水文预报》和《工程水文学》两本书，给出相对来说便于编程计算的方法，表述如下（参考《工程水文学》图4-6）：

因为基流不是本次降雨形成的，首先从流量过程线将其分割出去（所以地下径流一般指的是本次降雨形成的浅层地下径流，深层地下径流比较稳定，流量也小），一般取历年最枯流量的平均值或本年汛前最枯流量用水平线分割，令为直线ED；

然后根据洪水流量过程找到场次洪水起涨点A；

根据A和退水曲线计算出其与ED交点F；

用退水曲线段反算A至刚大于B停止；

将B-A-F曲线与B点开始的场次洪水过程线做差值；

倒序检查极小值点，在B-C'之间选择一个靠近C'的极小值带你作为分离点；

然后按退水曲线计算退水过程即可；

注意在离散状态下计算地表径流值；

排除掉上次洪水的退水过程，也可以得到地下径流值。